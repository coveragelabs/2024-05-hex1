# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: `abi.encodePacked()` should not be used with dynamic types when passing the result to a hash function such as `keccak256()`](#h-1-abiencodepacked-should-not-be-used-with-dynamic-types-when-passing-the-result-to-a-hash-function-such-as-keccak256)
  - [H-2: Using `block.timestamp` for swap deadline offers no protection](#h-2-using-blocktimestamp-for-swap-deadline-offers-no-protection)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk for trusted owners](#l-1-centralization-risk-for-trusted-owners)
  - [L-2: Unsafe ERC20 Operations should not be used](#l-2-unsafe-erc20-operations-should-not-be-used)
  - [L-3: Missing checks for `address(0)` when assigning values to address state variables](#l-3-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [L-4: `public` functions not used internally could be marked `external`](#l-4-public-functions-not-used-internally-could-be-marked-external)
  - [L-5: Define and use `constant` variables instead of using literals](#l-5-define-and-use-constant-variables-instead-of-using-literals)
  - [L-6: The `nonReentrant` `modifier` should occur before all other modifiers](#l-6-the-nonreentrant-modifier-should-occur-before-all-other-modifiers)
  - [L-7: Using `ERC721::_mint()` can be dangerous](#l-7-using-erc721mint-can-be-dangerous)
  - [L-8: PUSH0 is not supported by all chains](#l-8-push0-is-not-supported-by-all-chains)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 7 |
| Total nSLOC | 747 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/HexOneBootstrap.sol | 227 |
| src/HexOnePool.sol | 70 |
| src/HexOnePoolManager.sol | 51 |
| src/HexOnePriceFeed.sol | 118 |
| src/HexOneToken.sol | 16 |
| src/HexOneVault.sol | 223 |
| src/HexitToken.sol | 42 |
| **Total** | **747** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 2 |
| Low | 8 |


# High Issues

## H-1: `abi.encodePacked()` should not be used with dynamic types when passing the result to a hash function such as `keccak256()`

Use `abi.encode()` instead which will pad items to 32 bytes, which will [prevent hash collisions](https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode) (e.g. `abi.encodePacked(0x123,0x456)` => `0x123456` => `abi.encodePacked(0x1,0x23456)`, but `abi.encode(0x123,0x456)` => `0x0...1230...456`). Unless there is a compelling reason, `abi.encode` should be preferred. If there is only one argument to `abi.encodePacked()` it can often be cast to `bytes()` or `bytes32()` [instead](https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739).
If all arguments are strings and or bytes, `bytes.concat()` should be used instead.

- Found in src/HexOnePoolManager.sol [Line: 98](src/HexOnePoolManager.sol#L98)

	```solidity
	            abi.encodePacked(type(HexOnePool).creationCode, abi.encode(address(this), address(hexit), _token));
	```



## H-2: Using `block.timestamp` for swap deadline offers no protection

In the PoS model, proposers know well in advance if they will propose one or consecutive blocks ahead of time. In such a scenario, a malicious validator can hold back the transaction and execute it at a more favourable block number.Consider allowing function caller to specify swap deadline input parameter.

- Found in src/HexOneBootstrap.sol [Line: 184](src/HexOneBootstrap.sol#L184)

	```solidity
	            uint256[] memory amountsOut = IPulseXRouter(ROUTER_V1).swapExactTokensForTokens(
	```

- Found in src/HexOneBootstrap.sol [Line: 229](src/HexOneBootstrap.sol#L229)

	```solidity
	        uint256[] memory amountsOut = IPulseXRouter(ROUTER_V1).swapExactTokensForTokens(
	```

- Found in src/HexOneVault.sol [Line: 317](src/HexOneVault.sol#L317)

	```solidity
	            IPulseXRouter(ROUTER_V2).swapExactTokensForTokens(_fee, 0, path, address(this), block.timestamp);
	```



# Low Issues

## L-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

- Found in src/HexOneBootstrap.sol [Line: 23](src/HexOneBootstrap.sol#L23)

	```solidity
	contract HexOneBootstrap is AccessControl, ReentrancyGuard, IHexOneBootstrap {
	```

- Found in src/HexOneBootstrap.sol [Line: 204](src/HexOneBootstrap.sol#L204)

	```solidity
	    function processSacrifice(uint256 _amountOutMin) external nonReentrant onlyRole(OWNER_ROLE) {
	```

- Found in src/HexOneBootstrap.sol [Line: 304](src/HexOneBootstrap.sol#L304)

	```solidity
	    function startAirdrop(uint64 _airdropStart) external onlyRole(OWNER_ROLE) nonReentrant {
	```

- Found in src/HexOnePool.sol [Line: 15](src/HexOnePool.sol#L15)

	```solidity
	contract HexOnePool is AccessControl, IHexOnePool {
	```

- Found in src/HexOnePool.sol [Line: 65](src/HexOnePool.sol#L65)

	```solidity
	    function initialize(uint256 _rewardPerToken) external onlyRole(MANAGER_ROLE) {
	```

- Found in src/HexOnePoolManager.sol [Line: 15](src/HexOnePoolManager.sol#L15)

	```solidity
	contract HexOnePoolManager is AccessControl, IHexOnePoolManager {
	```

- Found in src/HexOnePoolManager.sol [Line: 42](src/HexOnePoolManager.sol#L42)

	```solidity
	    function createPools(address[] memory _tokens, uint256[] memory _rewardsPerToken) external onlyRole(OWNER_ROLE) {
	```

- Found in src/HexOnePoolManager.sol [Line: 62](src/HexOnePoolManager.sol#L62)

	```solidity
	    function createPool(address _token, uint256 _rewardPerToken) external onlyRole(OWNER_ROLE) {
	```

- Found in src/HexOnePriceFeed.sol [Line: 18](src/HexOnePriceFeed.sol#L18)

	```solidity
	contract HexOnePriceFeed is AccessControl, IHexOnePriceFeed {
	```

- Found in src/HexOnePriceFeed.sol [Line: 69](src/HexOnePriceFeed.sol#L69)

	```solidity
	    function addPath(address[] memory _path) external onlyRole(OWNER_ROLE) {
	```

- Found in src/HexOnePriceFeed.sol [Line: 91](src/HexOnePriceFeed.sol#L91)

	```solidity
	    function changePeriod(uint256 _period) external onlyRole(OWNER_ROLE) {
	```

- Found in src/HexOneToken.sol [Line: 13](src/HexOneToken.sol#L13)

	```solidity
	contract HexOneToken is ERC20, AccessControl, IHexOneToken {
	```

- Found in src/HexOneToken.sol [Line: 31](src/HexOneToken.sol#L31)

	```solidity
	    function mint(address _account, uint256 _amount) external onlyRole(VAULT_ROLE) {
	```

- Found in src/HexOneToken.sol [Line: 41](src/HexOneToken.sol#L41)

	```solidity
	    function burn(address _account, uint256 _amount) external onlyRole(VAULT_ROLE) {
	```

- Found in src/HexOneVault.sol [Line: 25](src/HexOneVault.sol#L25)

	```solidity
	contract HexOneVault is ERC721, AccessControl, ReentrancyGuard, IHexOneVault {
	```

- Found in src/HexOneVault.sol [Line: 137](src/HexOneVault.sol#L137)

	```solidity
	    function enableBuyback() external onlyRole(BOOTSTRAP_ROLE) {
	```

- Found in src/HexitToken.sol [Line: 13](src/HexitToken.sol#L13)

	```solidity
	contract HexitToken is ERC20, AccessControl, IHexitToken {
	```

- Found in src/HexitToken.sol [Line: 44](src/HexitToken.sol#L44)

	```solidity
	    function initManager(address _manager) external initializer onlyRole(OWNER_ROLE) {
	```

- Found in src/HexitToken.sol [Line: 59](src/HexitToken.sol#L59)

	```solidity
	    function initFeed(address _feed) external initializer onlyRole(OWNER_ROLE) {
	```

- Found in src/HexitToken.sol [Line: 74](src/HexitToken.sol#L74)

	```solidity
	    function initBootstrap(address _bootstrap) external initializer onlyRole(OWNER_ROLE) {
	```

- Found in src/HexitToken.sol [Line: 89](src/HexitToken.sol#L89)

	```solidity
	    function initPool(address _pool) external onlyRole(MANAGER_ROLE) {
	```

- Found in src/HexitToken.sol [Line: 100](src/HexitToken.sol#L100)

	```solidity
	    function mint(address _account, uint256 _amount) external onlyRole(MINTER_ROLE) {
	```



## L-2: Unsafe ERC20 Operations should not be used

ERC20 functions may not behave as expected. For example: return values are not always meaningful. It is recommended to use OpenZeppelin's SafeERC20 library.

- Found in src/HexOneBootstrap.sol [Line: 178](src/HexOneBootstrap.sol#L178)

	```solidity
	            IERC20(_token).approve(ROUTER_V1, _amount);
	```

- Found in src/HexOneBootstrap.sol [Line: 223](src/HexOneBootstrap.sol#L223)

	```solidity
	        IERC20(HX).approve(ROUTER_V1, halfHxAmount);
	```

- Found in src/HexOneBootstrap.sol [Line: 236](src/HexOneBootstrap.sol#L236)

	```solidity
	        IERC20(HX).approve(address(vault), halfHxAmount);
	```

- Found in src/HexOneBootstrap.sol [Line: 245](src/HexOneBootstrap.sol#L245)

	```solidity
	        IERC20(hex1).approve(ROUTER_V2, hex1Amount);
	```

- Found in src/HexOneBootstrap.sol [Line: 246](src/HexOneBootstrap.sol#L246)

	```solidity
	        IERC20(DAI).approve(ROUTER_V2, amountsOut[1]);
	```

- Found in src/HexOneBootstrap.sol [Line: 285](src/HexOneBootstrap.sol#L285)

	```solidity
	        IERC20(HX).approve(address(vault), hxToDeposit);
	```

- Found in src/HexOneBootstrap.sol [Line: 292](src/HexOneBootstrap.sol#L292)

	```solidity
	        vault.transferFrom(address(this), msg.sender, tokenId);
	```

- Found in src/HexOneBootstrap.sol [Line: 293](src/HexOneBootstrap.sol#L293)

	```solidity
	        IERC20(vault.hex1()).transfer(msg.sender, hex1Minted);
	```

- Found in src/HexOneVault.sol [Line: 308](src/HexOneVault.sol#L308)

	```solidity
	        IERC20(HX).approve(ROUTER_V2, _fee);
	```



## L-3: Missing checks for `address(0)` when assigning values to address state variables

Check for `address(0)` when assigning values to address state variables.

- Found in src/HexOnePool.sol [Line: 144](src/HexOnePool.sol#L144)

	```solidity
	        earned[_account] += _calculateRewards(_account);
	```

- Found in src/HexOnePriceFeed.sol [Line: 81](src/HexOnePriceFeed.sol#L81)

	```solidity
	        paths[tokenIn][tokenOut] = _path;
	```



## L-4: `public` functions not used internally could be marked `external`

Instead of marking a function as `public`, consider marking it as `external` if it is not used internally.

- Found in src/HexOneVault.sol [Line: 90](src/HexOneVault.sol#L90)

	```solidity
	    function supportsInterface(bytes4 _interfaceId) public view override(ERC721, AccessControl) returns (bool) {
	```



## L-5: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

- Found in src/HexOneBootstrap.sol [Line: 281](src/HexOneBootstrap.sol#L281)

	```solidity
	        uint256 shares = (user.sacrificedUsd * 1e18) / info.sacrificedUsd;
	```

- Found in src/HexOneBootstrap.sol [Line: 282](src/HexOneBootstrap.sol#L282)

	```solidity
	        uint256 hxToDeposit = (shares * info.remainingHx) / 1e18;
	```

- Found in src/HexOneBootstrap.sol [Line: 361](src/HexOneBootstrap.sol#L361)

	```solidity
	        hexitShares = (_sacrificedUsd * _baseDailyHexit(sacrificeDay())) / 1e18;
	```

- Found in src/HexOneVault.sol [Line: 372](src/HexOneVault.sol#L372)

	```solidity
	        if (decimals >= 18) {
	```

- Found in src/HexOneVault.sol [Line: 373](src/HexOneVault.sol#L373)

	```solidity
	            amountOut = _amountIn / (10 ** (decimals - 18));
	```

- Found in src/HexOneVault.sol [Line: 375](src/HexOneVault.sol#L375)

	```solidity
	            amountOut = _amountIn * (10 ** (18 - decimals));
	```



## L-6: The `nonReentrant` `modifier` should occur before all other modifiers

This is a best-practice to protect against reentrancy in other modifiers.

- Found in src/HexOneBootstrap.sol [Line: 304](src/HexOneBootstrap.sol#L304)

	```solidity
	    function startAirdrop(uint64 _airdropStart) external onlyRole(OWNER_ROLE) nonReentrant {
	```



## L-7: Using `ERC721::_mint()` can be dangerous

Using `ERC721::_mint()` can mint ERC721 tokens to addresses which don't support ERC721 tokens. Use `_safeMint()` instead of `_mint()` for ERC721.

- Found in src/HexOneVault.sol [Line: 159](src/HexOneVault.sol#L159)

	```solidity
	        _mint(msg.sender, tokenId);
	```



## L-8: PUSH0 is not supported by all chains

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

- Found in src/HexOneBootstrap.sol [Line: 2](src/HexOneBootstrap.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```

- Found in src/HexOnePool.sol [Line: 2](src/HexOnePool.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```

- Found in src/HexOnePoolManager.sol [Line: 2](src/HexOnePoolManager.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```

- Found in src/HexOnePriceFeed.sol [Line: 2](src/HexOnePriceFeed.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```

- Found in src/HexOneToken.sol [Line: 2](src/HexOneToken.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```

- Found in src/HexOneVault.sol [Line: 2](src/HexOneVault.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```

- Found in src/HexitToken.sol [Line: 2](src/HexitToken.sol#L2)

	```solidity
	pragma solidity 0.8.20;
	```



